{
	"extends": "cylinder2.vwf",
	"source": "vwf/model/threejs/cylinder.js",
	"type": "subDriver/threejs",
	"sequence": 0,
	"random": {
		"s0": 0.253239,
		"s1": 0.087662,
		"s2": 0.091676,
		"c": 302051
	},
	"properties": {
		"___physics_activation_state": 1,
		"___physics_deactivation_time": 0,
		"___physics_velocity_linear": [
			0,
			0,
			0
		],
		"___physics_velocity_angular": [
			0,
			0,
			0
		],
		"DisplayName": "Missile",
		"EditorData": {
			"fired": {
				"displayname": "Fired",
				"property": "fired",
				"type": "check"
			}
		},
		"___physics_angular_velocity": [
			0,
			0,
			0
		],
		"___physics_constant_force": [
			0,
			0,
			980
		],
		"___physics_damping": 0.3,
		"___physics_enabled": true,
		"___physics_linear_velocity": [
			0,
			0,
			0
		],
		"___physics_mass": 100,
		"___sourceAssetTimestamp": "Tue Nov 24 2015 16:22:57 GMT-0500 (Eastern Standard Time)",
		"counter": 0,
		"explosionDef": {
			"continues": "/sas/assets/d3402bc3",
			"properties": {
				"fuse": 1,
				"transform": [
					1,
					0,
					0,
					0,
					0,
					1,
					0,
					0,
					0,
					0,
					1,
					0,
					0,
					0,
					0,
					1
				]
			}
		},
		"fired": true,
		"force": "B",
		"height": 1.6,
		"launchedBy": "",
		"materialDef": {
			"alpha": 1,
			"ambient": {
				"b": 1,
				"g": 1,
				"r": 1
			},
			"blendMode": 1,
			"color": {
				"a": 1,
				"b": 1,
				"g": 1,
				"r": 1
			},
			"depthtest": true,
			"depthwrite": true,
			"emit": {
				"b": 0,
				"g": 0,
				"r": 0
			},
			"fog": true,
			"layers": [],
			"metal": false,
			"reflect": 0.8,
			"shadeless": false,
			"shading": true,
			"shadow": true,
			"shininess": 15,
			"side": 0,
			"specularColor": {
				"b": 0.57735,
				"g": 0.57735,
				"r": 0.57735
			},
			"specularLevel": 1,
			"type": "phong",
			"vertexColors": false,
			"wireframe": false
		},
		"owner": "ADLteam",
		"radius": 0.05,
		"sourceAssetId": "73e8a4a3",
		"target_data": {
			"id": ""
		},
		"transform": [
			-0.9982399940490723,
			0.0357230007648468,
			0.015585999935865402,
			0,
			0.017388999462127686,
			0.05156400054693222,
			0.9955130219459534,
			0,
			0.034793999046087265,
			0.9950270056724548,
			-0.0521479994058609,
			0,
			-31.241649627685547,
			16.37545394897461,
			0.4593130052089691,
			1
		],
		"turnRadius": 300,
		"type": "Primitive",
		"worldTransform": [
			-0.9982399940490723,
			0.0357230007648468,
			0.015585999935865402,
			0,
			0.017388999462127686,
			0.05156400054693222,
			0.9955130219459534,
			0,
			0.034793999046087265,
			0.9950270056724548,
			-0.0521479994058609,
			0,
			-31.241649627685547,
			16.37545394897461,
			0.4593130052089691,
			1
		],
		"stmtId": ""
	},
	"methods": {
		"collision": {
			"body": "// The body has collided with another body. The ID of the node is param 1, collision data in param 2\n    if (this.counter > 20)\n    {\n        this.explode();\n        this.xAPISend(obstacle);\n        var node = this.Scene.findNodeByID(obstacle);\n        if (node && node.hit)\n            node.hit([0, 0, 0], 50);\n        vwf.deleteNode(this.id);\n        return;\n    }",
			"parameters": [
				"obstacle",
				"data"
			]
		},
		"target_info": {
			"body": "if (info && info.force !== this.force)\n    {\n        this.target_data = info;\n        console.log('targeting');\n    }\n    console.log(\"got here\");",
			"parameters": [
				"info"
			]
		},
		"xAPISend": {
			"body": "console.log(\"Missile xAPI Send\");\n    var sender = this.Scene.children_by_name.xAPISender;\n    if (sender)\n    {\n        var res = false;\n        if (objName) res = true;\n        var result = {\n            success: res,\n            response: \"true = hit, false = miss\"\n        };\n        var conExt = {\n            \"https://sandbox.adlnet.gov/context/extensions/target\": this.target_data || \"no target\",\n            \"https://sandbox.adlnet.gov/context/extensions/missileId\": (this.continues + this.stmtId) || \"Missile#2\",\n            \"https://sandbox.adlnet.gov/context/extensions/hitPosition\": this.transformAPI.getWorldPosition() || \"this is where the missile collided\",\n            \"https://sandbox.adlnet.gov/context/extensions/scene/time/\": Math.floor(this.Scene.time * 1000) / 1000,\n        };\n\n        sender.xAPISend(\"hit\", (objName || \"missed\"), \"Match statement id\", result, conExt, this.stmtId);\n    }",
			"parameters": [
				"objName"
			]
		},
		"explode": {
			"body": "var def = this.explosionDef;\n    var pos = this.transformAPI.getWorldPosition();\n\n    def.properties.transform[12] = pos[0];\n    def.properties.transform[13] = pos[1];\n    def.properties.transform[14] = pos[2];\n    var now = performance.now();\n    // console.profile(\"launch\");\n    this.Scene.createChild( GUID(), _DataManager.getCleanNodePrototype(def), null, function(childID)\n    {\n        vwf.callMethod(childID, 'explode');\n    });",
			"parameters": []
		},
		"hit": {
			"body": "this.explode();\n    this.delete();",
			"parameters": []
		},
		"tick": {
			"body": "if (!this.fired)\n        return;\n    // The tick function is called 20 times every second.\n    // Write code here to animate over time\n\n    if (this.counter < 80 && this.counter > 0)\n    {\n\n        var force = this.transformAPI.localToGlobal(0, 0, -60 * this.physicsAPI.getMass());\n        this.physicsAPI.addForceAtCenter(force);\n        this.children_by_name.ParticleSystem1.visible = true;\n        // this.physicsAPI.addTorque([this.random() * 10, this.random() * 10, this.random() * 1]);\n\n    }\n\n    var targetNode = null;\n\n    if (!this.target_data.id)\n    {\n        var localUp = this.transformAPI.localToGlobalRotation(0, 0, 1);\n        var localSide = MATH.crossVec3(localUp, [0, 0, 1]);\n        var angle = MATH.dotVec3(localUp, [0, 0, 1]);\n        angle += -.02;\n        if (this.counter > 10)\n        {\n            if (angle < 0)\n            {\n                this.transformAPI.rotateAroundAxis(-10 * angle, localSide, this.transformAPI.COORDINATES.GLOBAL);\n            }\n            else\n            {\n                this.transformAPI.rotateAroundAxis(10 * angle, localSide, this.transformAPI.COORDINATES.GLOBAL);\n            }\n        }\n    }\n    else if (targetNode = this.Scene.findNodeByID(this.target_data.id)) // have target!\n    {\n\n        var targetPos = this.transformAPI.localToGlobal(0, 0, -1);\n        this.target_data.position = targetNode.transformAPI.getWorldPosition();\n\n        targetPos[0] = (targetPos[0] * this.turnRadius + this.target_data.position[0] * 1) / (this.turnRadius + 1);\n        targetPos[1] = (targetPos[1] * this.turnRadius + this.target_data.position[1] * 1) / (this.turnRadius + 1);\n        targetPos[2] = (targetPos[2] * this.turnRadius + this.target_data.position[2] * 1) / (this.turnRadius + 1);\n\n        var frontDir = this.transformAPI.localToGlobalRotation(0, 0, -1);\n        var targetDir = MATH.subVec3(targetPos, this.transformAPI.getWorldPosition());\n        if (MATH.distanceVec3(this.transformAPI.getWorldPosition(), this.target_data.position) < 5)\n        {\n            this.hit();\n            return;\n        }\n        targetDir = MATH.toUnitVec3(targetDir);\n\n        if (MATH.dotVec3(frontDir, targetDir) > .5)\n            this.transformAPI.lookat(targetPos, null, 'Z', 'Y');\n\n    }\n\n    if (this.counter > 20 && this.counter < 270)\n    {\n\n        var offset = this.transformAPI.localToGlobalRotation(0, 0, 1);\n        var center = this.transformAPI.getPosition();\n        var hit = this.Scene.traceAPI.rayCast(center, offset,\n        {\n            ignore: [findviewnode(this.id)]\n        });\n        if (hit && hit.distance < 2)\n        {\n\n            if (hit.node && hit.node.hit)\n            {\n                hit.node.hit(hit.point, 50);\n            }\n            this.explode();\n            console.log(hit);\n            this.xAPISend(hit.node.DisplayName || 'something');\n            this.delete();\n            return;\n        }\n    }\n    // if (this.counter > 60)\n    //        this.children_by_name.ParticleSystem1.visible = false;\n    this.counter++;\n\n    if (this.counter > 10 && this.counter < 270)\n    {\n        var vel = this.physicsAPI.getLinearVelocity();\n        var speed = MATH.lengthVec3(vel);\n        vel = this.transformAPI.globalToLocalRotation(vel);\n        vel[0] = 0;\n        vel[1] = 0;\n        vel = MATH.toUnitVec3(vel);\n        vel = MATH.scaleVec3(vel, speed);\n        vel = this.transformAPI.localToGlobalRotation(vel);\n        this.physicsAPI.setLinearVelocity(vel);\n    }\n    if (this.counter > 270)\n    {\n        this.xAPISend(null);\n        this.delete();\n    }",
			"parameters": []
		}
	},
	"children": {
		"N4cfbf547": {
			"extends": "SandboxParticleSystem.vwf",
			"sequence": 0,
			"random": {
				"s0": 0.956842,
				"s1": 0.666903,
				"s2": 0.367152,
				"c": 1
			},
			"properties": {
				"DisplayName": "ParticleSystem1",
				"___assetServerOriginalID": "N4cfbf547",
				"additive": true,
				"counter": 0,
				"depthTest": false,
				"image": "../vwfDataManager.svc/texture?UID=fire.png",
				"maxLifeTime": 23,
				"maxOrientation": 19.6,
				"maxRate": 5,
				"maxVelocity": [
					1,
					0,
					0.2
				],
				"minLifeTime": 23,
				"minOrientation": -21.4,
				"minVelocity": [
					-1,
					0,
					0.011
				],
				"owner": "Rob",
				"particleCount": 100,
				"solver": "AnalyticShader",
				"startSize": 0.3,
				"transform": [
					1,
					0,
					0,
					0,
					0,
					-1,
					0,
					0,
					0,
					-0.000001,
					-1,
					0,
					-0.000001,
					0,
					0.499998,
					1
				],
				"type": "ParticleSystem",
				"velocityMode": "spherical",
				"visible": true
			}
		}
	}
}